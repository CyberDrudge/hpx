<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<title>Class template task_block</title>
<link rel="stylesheet" href="../../../src/boostbook.css" type="text/css">
<meta name="generator" content="DocBook XSL Stylesheets V1.78.1">
<link rel="home" href="../../../index.html" title="HPX 1.2.0">
<link rel="up" href="../../../header/hpx/parallel/task_block_hpp.html" title="Header &lt;hpx/parallel/task_block.hpp&gt;">
<link rel="prev" href="task_canceled_exception.html" title="Class task_canceled_exception">
<link rel="next" href="define__idm140195460900672.html" title="Function template define_task_block">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<table cellpadding="2" width="100%"><tr><td valign="top"><img alt="HPX" width="567" height="125" src="../../../images/hpx_1_2_0_draft.png"></td></tr></table>
<hr>
<div class="spirit-nav">
<a accesskey="p" href="task_canceled_exception.html"><img src="../../../images/prev.png" alt="Prev"></a><a accesskey="u" href="../../../header/hpx/parallel/task_block_hpp.html"><img src="../../../images/up.png" alt="Up"></a><a accesskey="h" href="../../../index.html"><img src="../../../images/home.png" alt="Home"></a><a accesskey="n" href="define__idm140195460900672.html"><img src="../../../images/next.png" alt="Next"></a>
</div>
<div class="refentry">
<a name="hpx.parallel.v2.task_block"></a><div class="titlepage"></div>
<div class="refnamediv">
<h2><span class="refentrytitle">Class template task_block</span></h2>
<p>hpx::parallel::v2::task_block</p>
</div>
<h2 xmlns:rev="http://www.cs.rpi.edu/~gregod/boost/tools/doc/revision" class="refsynopsisdiv-title">Synopsis</h2>
<div xmlns:rev="http://www.cs.rpi.edu/~gregod/boost/tools/doc/revision" class="refsynopsisdiv"><pre class="synopsis"><span class="comment">// In header: &lt;<a class="link" href="../../../header/hpx/parallel/task_block_hpp.html" title="Header &lt;hpx/parallel/task_block.hpp&gt;">hpx/parallel/task_block.hpp</a>&gt;

</span><span class="keyword">template</span><span class="special">&lt;</span><span class="keyword">typename</span> ExPolicy <span class="special">=</span> <a class="link" href="../execution/parallel_policy.html" title="Struct parallel_policy">parallel::execution::parallel_policy</a><span class="special">&gt;</span> 
<span class="keyword">class</span> <a class="link" href="task_block.html" title="Class template task_block">task_block</a> <span class="special">{</span>
<span class="keyword">public</span><span class="special">:</span>
  <span class="comment">// <a class="link" href="task_block.html#hpx.parallel.v2.task_blocktypes">types</a></span>
  <span class="keyword">typedef</span> <span class="identifier">ExPolicy</span> <a class="link" href="task_block.html#hpx.parallel.v2.task_block.execution_policy"><span class="identifier">execution_policy</span></a><span class="special">;</span>

  <span class="comment">// <a class="link" href="task_block.html#idm140195460943632-bb">public member functions</a></span>
  <span class="identifier">execution_policy</span> <span class="keyword">const</span> <span class="special">&amp;</span> <a class="link" href="task_block.html#idm140195460943072-bb"><span class="identifier">get_execution_policy</span></a><span class="special">(</span><span class="special">)</span> <span class="keyword">const</span><span class="special">;</span>
  <span class="keyword">template</span><span class="special">&lt;</span><span class="keyword">typename</span> F<span class="special">,</span> <span class="keyword">typename</span><span class="special">...</span> Ts<span class="special">&gt;</span> <span class="keyword">void</span> <a class="link" href="task_block.html#idm140195460940608-bb"><span class="identifier">run</span></a><span class="special">(</span><span class="identifier">F</span> <span class="special">&amp;&amp;</span><span class="special">,</span> <span class="identifier">Ts</span> <span class="special">&amp;&amp;</span><span class="special">...</span><span class="special">)</span><span class="special">;</span>
  <span class="keyword">template</span><span class="special">&lt;</span><span class="keyword">typename</span> Executor<span class="special">,</span> <span class="keyword">typename</span> F<span class="special">,</span> <span class="keyword">typename</span><span class="special">...</span> Ts<span class="special">&gt;</span> 
    <span class="keyword">void</span> <a class="link" href="task_block.html#idm140195460927776-bb"><span class="identifier">run</span></a><span class="special">(</span><span class="identifier">Executor</span> <span class="special">&amp;</span><span class="special">,</span> <span class="identifier">F</span> <span class="special">&amp;&amp;</span><span class="special">,</span> <span class="identifier">Ts</span> <span class="special">&amp;&amp;</span><span class="special">...</span><span class="special">)</span><span class="special">;</span>
  <span class="keyword">void</span> <a class="link" href="task_block.html#idm140195460913584-bb"><span class="identifier">wait</span></a><span class="special">(</span><span class="special">)</span><span class="special">;</span>
  <span class="identifier">ExPolicy</span> <span class="special">&amp;</span> <a class="link" href="task_block.html#idm140195460905840-bb"><span class="identifier">policy</span></a><span class="special">(</span><span class="special">)</span><span class="special">;</span>
  <span class="identifier">ExPolicy</span> <span class="keyword">const</span> <span class="special">&amp;</span> <a class="link" href="task_block.html#idm140195460903472-bb"><span class="identifier">policy</span></a><span class="special">(</span><span class="special">)</span> <span class="keyword">const</span><span class="special">;</span>
<span class="special">}</span><span class="special">;</span></pre></div>
<div class="refsect1">
<a name="idm140023342848496"></a><h2>Description</h2>
<p>The class <a class="link" href="task_block.html" title="Class template task_block">task_block</a> defines an interface for forking and joining parallel tasks. The <span class="emphasis"><em>define_task_block</em></span> and <span class="emphasis"><em>define_task_block_restore_thread</em></span> function templates create an object of type <a class="link" href="task_block.html" title="Class template task_block">task_block</a> and pass a reference to that object to a user-provided callable object.</p>
<p>An object of class <span class="emphasis"><em><a class="link" href="task_block.html" title="Class template task_block">task_block</a></em></span> cannot be constructed, destroyed, copied, or moved except by the implementation of the task region library. Taking the address of a <a class="link" href="task_block.html" title="Class template task_block">task_block</a> object via operator&amp; or addressof is ill formed. The result of obtaining its address by any other means is unspecified.</p>
<p>A <span class="emphasis"><em><a class="link" href="task_block.html" title="Class template task_block">task_block</a></em></span> is active if it was created by the nearest enclosing task block, where "task block" refers to an invocation of define_task_block or define_task_block_restore_thread and "nearest
   enclosing" means the most recent invocation that has not yet completed. Code designated for execution in another thread by means other than the facilities in this section (e.g., using thread or async) are not enclosed in the task region and a <a class="link" href="task_block.html" title="Class template task_block">task_block</a> passed to (or captured by) such code is not active within that code. Performing any operation on a <a class="link" href="task_block.html" title="Class template task_block">task_block</a> that is not active results in undefined behavior.</p>
<p>The <span class="emphasis"><em><a class="link" href="task_block.html" title="Class template task_block">task_block</a></em></span> that is active before a specific call to the run member function is not active within the asynchronous function that invoked run. (The invoked function should not, therefore, capture the <span class="emphasis"><em><a class="link" href="task_block.html" title="Class template task_block">task_block</a></em></span> from the surrounding block.)</p>
<pre class="programlisting"><span class="special">*</span>  <span class="identifier">Example</span><span class="special">:</span>
<span class="special">*</span>      <span class="identifier">define_task_block</span><span class="special">(</span><span class="special">[</span><span class="special">&amp;</span><span class="special">]</span><span class="special">(</span><span class="keyword">auto</span><span class="special">&amp;</span> <span class="identifier">tr</span><span class="special">)</span> <span class="special">{</span>
<span class="special">*</span>          <span class="identifier">tr</span><span class="special">.</span><span class="identifier">run</span><span class="special">(</span><span class="special">[</span><span class="special">&amp;</span><span class="special">]</span> <span class="special">{</span>
<span class="special">*</span>              <span class="identifier">tr</span><span class="special">.</span><span class="identifier">run</span><span class="special">(</span><span class="special">[</span><span class="special">]</span> <span class="special">{</span> <span class="identifier">f</span><span class="special">(</span><span class="special">)</span><span class="special">;</span> <span class="special">}</span><span class="special">)</span><span class="special">;</span>                <span class="comment">// Error: tr is not active</span>
<span class="special">*</span>              <span class="identifier">define_task_block</span><span class="special">(</span><span class="special">[</span><span class="special">&amp;</span><span class="special">]</span><span class="special">(</span><span class="keyword">auto</span><span class="special">&amp;</span> <span class="identifier">tr</span><span class="special">)</span> <span class="special">{</span>   <span class="comment">// Nested task block</span>
<span class="special">*</span>                  <span class="identifier">tr</span><span class="special">.</span><span class="identifier">run</span><span class="special">(</span><span class="identifier">f</span><span class="special">)</span><span class="special">;</span>                      <span class="comment">// OK: inner tr is active</span>
<span class="special">*</span>                  
<span class="special">*</span>              <span class="special">}</span><span class="special">)</span><span class="special">;</span>
<span class="special">*</span>          <span class="special">}</span><span class="special">)</span><span class="special">;</span>
<span class="special">*</span>          
<span class="special">*</span>      <span class="special">}</span><span class="special">)</span><span class="special">;</span>
<span class="special">*</span>  
</pre>
<p>
</p>
<div class="refsect2">
<a name="idm140023342790432"></a><h3>Template Parameters</h3>
<div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
<pre class="literallayout"><span class="keyword">typename</span> ExPolicy <span class="special">=</span> <a class="link" href="../execution/parallel_policy.html" title="Struct parallel_policy">parallel::execution::parallel_policy</a></pre>
<p>The execution policy an instance of a <span class="emphasis"><em><code class="computeroutput"><a class="link" href="task_block.html" title="Class template task_block">task_block</a></code></em></span> was created with. This defaults to <span class="emphasis"><em>parallel_policy</em></span>. </p>
</li></ol></div>
</div>
<div class="refsect2">
<a name="idm140023342784064"></a><h3>
<a name="hpx.parallel.v2.task_blocktypes"></a><code class="computeroutput">task_block</code> 
        public
       types</h3>
<div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
<p>
<span class="keyword">typedef</span> <span class="identifier">ExPolicy</span> <a name="hpx.parallel.v2.task_block.execution_policy"></a><span class="identifier">execution_policy</span><span class="special">;</span></p>
<p>Refers to the type of the execution policy used to create the <span class="emphasis"><em><a class="link" href="task_block.html" title="Class template task_block">task_block</a></em></span>. </p>
</li></ol></div>
</div>
<div class="refsect2">
<a name="idm140023342776992"></a><h3>
<a name="idm140195460943632-bb"></a><code class="computeroutput">task_block</code> public member functions</h3>
<div class="orderedlist"><ol class="orderedlist" type="1">
<li class="listitem">
<pre class="literallayout"><span class="identifier">execution_policy</span> <span class="keyword">const</span> <span class="special">&amp;</span> <a name="idm140195460943072-bb"></a><span class="identifier">get_execution_policy</span><span class="special">(</span><span class="special">)</span> <span class="keyword">const</span><span class="special">;</span></pre>
<p>Return the execution policy instance used to create this <span class="emphasis"><em><code class="computeroutput"><a class="link" href="task_block.html" title="Class template task_block">task_block</a></code></em></span> </p>
</li>
<li class="listitem">
<pre class="literallayout"><span class="keyword">template</span><span class="special">&lt;</span><span class="keyword">typename</span> F<span class="special">,</span> <span class="keyword">typename</span><span class="special">...</span> Ts<span class="special">&gt;</span> <span class="keyword">void</span> <a name="idm140195460940608-bb"></a><span class="identifier">run</span><span class="special">(</span><span class="identifier">F</span> <span class="special">&amp;&amp;</span> f<span class="special">,</span> <span class="identifier">Ts</span> <span class="special">&amp;&amp;</span><span class="special">...</span> ts<span class="special">)</span><span class="special">;</span></pre>
<p>Causes the expression f() to be invoked asynchronously. The invocation of f is permitted to run on an unspecified thread in an unordered fashion relative to the sequence of operations following the call to run(f) (the continuation), or indeterminately sequenced within the same thread as the continuation.</p>
<p>The call to <span class="emphasis"><em>run</em></span> synchronizes with the invocation of f. The completion of f() synchronizes with the next invocation of wait on the same <code class="computeroutput"><a class="link" href="task_block.html" title="Class template task_block">task_block</a></code> or completion of the nearest enclosing task block (i.e., the <span class="emphasis"><em>define_task_block</em></span> or <span class="emphasis"><em>define_task_block_restore_thread</em></span> that created this task block).</p>
<p>Requires: F shall be MoveConstructible. The expression, (void)f(), shall be well-formed.</p>
<p>Precondition: this shall be the active <code class="computeroutput"><a class="link" href="task_block.html" title="Class template task_block">task_block</a></code>.</p>
<p>Postconditions: A call to run may return on a different thread than that on which it was called.</p>
<div class="note"><table border="0" summary="Note">
<tr>
<td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="../../../images/note.png"></td>
<th align="left">Note</th>
</tr>
<tr><td align="left" valign="top"><p>The call to <span class="emphasis"><em>run</em></span> is sequenced before the continuation as if <span class="emphasis"><em>run</em></span> returns on the same thread. The invocation of the user-supplied callable object f may be immediate or may be delayed until compute resources are available. <span class="emphasis"><em>run</em></span> might or might not return before invocation of f completes.</p></td></tr>
</table></div>
<p>

</p>
<div class="variablelist"><table border="0" class="variablelist compact">
<colgroup>
<col align="left" valign="top">
<col>
</colgroup>
<tbody><tr>
<td><p><span class="term">Throws:</span></p></td>
<td>This function may throw <span class="emphasis"><em><a class="link" href="task_canceled_exception.html" title="Class task_canceled_exception">task_canceled_exception</a></em></span>, as described in Exception Handling. </td>
</tr></tbody>
</table></div>
</li>
<li class="listitem">
<pre class="literallayout"><span class="keyword">template</span><span class="special">&lt;</span><span class="keyword">typename</span> Executor<span class="special">,</span> <span class="keyword">typename</span> F<span class="special">,</span> <span class="keyword">typename</span><span class="special">...</span> Ts<span class="special">&gt;</span> 
  <span class="keyword">void</span> <a name="idm140195460927776-bb"></a><span class="identifier">run</span><span class="special">(</span><span class="identifier">Executor</span> <span class="special">&amp;</span> exec<span class="special">,</span> <span class="identifier">F</span> <span class="special">&amp;&amp;</span> f<span class="special">,</span> <span class="identifier">Ts</span> <span class="special">&amp;&amp;</span><span class="special">...</span> ts<span class="special">)</span><span class="special">;</span></pre>
<p>Causes the expression f() to be invoked asynchronously using the given executor. The invocation of f is permitted to run on an unspecified thread associated with the given executor and in an unordered fashion relative to the sequence of operations following the call to run(exec, f) (the continuation), or indeterminately sequenced within the same thread as the continuation.</p>
<p>The call to <span class="emphasis"><em>run</em></span> synchronizes with the invocation of f. The completion of f() synchronizes with the next invocation of wait on the same <code class="computeroutput"><a class="link" href="task_block.html" title="Class template task_block">task_block</a></code> or completion of the nearest enclosing task block (i.e., the <span class="emphasis"><em>define_task_block</em></span> or <span class="emphasis"><em>define_task_block_restore_thread</em></span> that created this task block).</p>
<p>Requires: Executor shall be a type modeling the Executor concept. F shall be MoveConstructible. The expression, (void)f(), shall be well-formed.</p>
<p>Precondition: this shall be the active <code class="computeroutput"><a class="link" href="task_block.html" title="Class template task_block">task_block</a></code>.</p>
<p>Postconditions: A call to run may return on a different thread than that on which it was called.</p>
<div class="note"><table border="0" summary="Note">
<tr>
<td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="../../../images/note.png"></td>
<th align="left">Note</th>
</tr>
<tr><td align="left" valign="top"><p>The call to <span class="emphasis"><em>run</em></span> is sequenced before the continuation as if <span class="emphasis"><em>run</em></span> returns on the same thread. The invocation of the user-supplied callable object f may be immediate or may be delayed until compute resources are available. <span class="emphasis"><em>run</em></span> might or might not return before invocation of f completes.</p></td></tr>
</table></div>
<p>

</p>
<div class="variablelist"><table border="0" class="variablelist compact">
<colgroup>
<col align="left" valign="top">
<col>
</colgroup>
<tbody><tr>
<td><p><span class="term">Throws:</span></p></td>
<td>This function may throw <span class="emphasis"><em><a class="link" href="task_canceled_exception.html" title="Class task_canceled_exception">task_canceled_exception</a></em></span>, as described in Exception Handling. </td>
</tr></tbody>
</table></div>
</li>
<li class="listitem">
<pre class="literallayout"><span class="keyword">void</span> <a name="idm140195460913584-bb"></a><span class="identifier">wait</span><span class="special">(</span><span class="special">)</span><span class="special">;</span></pre>
<p>Blocks until the tasks spawned using this <code class="computeroutput"><a class="link" href="task_block.html" title="Class template task_block">task_block</a></code> have finished.</p>
<p>Precondition: this shall be the active <code class="computeroutput"><a class="link" href="task_block.html" title="Class template task_block">task_block</a></code>.</p>
<p>Postcondition: All tasks spawned by the nearest enclosing task region have finished. A call to wait may return on a different thread than that on which it was called.</p>
<div class="note"><table border="0" summary="Note">
<tr>
<td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="../../../images/note.png"></td>
<th align="left">Note</th>
</tr>
<tr><td align="left" valign="top"><p>The call to <span class="emphasis"><em>wait</em></span> is sequenced before the continuation as if <span class="emphasis"><em>wait</em></span> returns on the same thread.</p></td></tr>
</table></div>
<p>

</p>
<pre class="programlisting"><span class="special">*</span>  <span class="identifier">Example</span><span class="special">:</span>
<span class="special">*</span>      <span class="identifier">define_task_block</span><span class="special">(</span><span class="special">[</span><span class="special">&amp;</span><span class="special">]</span><span class="special">(</span><span class="keyword">auto</span><span class="special">&amp;</span> <span class="identifier">tr</span><span class="special">)</span> <span class="special">{</span>
<span class="special">*</span>          <span class="identifier">tr</span><span class="special">.</span><span class="identifier">run</span><span class="special">(</span><span class="special">[</span><span class="special">&amp;</span><span class="special">]</span><span class="special">{</span> <span class="identifier">process</span><span class="special">(</span><span class="identifier">a</span><span class="special">,</span> <span class="identifier">w</span><span class="special">,</span> <span class="identifier">x</span><span class="special">)</span><span class="special">;</span> <span class="special">}</span><span class="special">)</span><span class="special">;</span> <span class="comment">// Process a[w] through a[x]</span>
<span class="special">*</span>          <span class="keyword">if</span> <span class="special">(</span><span class="identifier">y</span> <span class="special">&lt;</span> <span class="identifier">x</span><span class="special">)</span> <span class="identifier">tr</span><span class="special">.</span><span class="identifier">wait</span><span class="special">(</span><span class="special">)</span><span class="special">;</span>   <span class="comment">// Wait if overlap between [w, x) and [y, z)</span>
<span class="special">*</span>          <span class="identifier">process</span><span class="special">(</span><span class="identifier">a</span><span class="special">,</span> <span class="identifier">y</span><span class="special">,</span> <span class="identifier">z</span><span class="special">)</span><span class="special">;</span>       <span class="comment">// Process a[y] through a[z]</span>
<span class="special">*</span>      <span class="special">}</span><span class="special">)</span><span class="special">;</span>
<span class="special">*</span>  
</pre>
<p> </p>
<div class="variablelist"><table border="0" class="variablelist compact">
<colgroup>
<col align="left" valign="top">
<col>
</colgroup>
<tbody><tr>
<td><p><span class="term">Throws:</span></p></td>
<td>This function may throw <span class="emphasis"><em><a class="link" href="task_canceled_exception.html" title="Class task_canceled_exception">task_canceled_exception</a></em></span>, as described in Exception Handling.</td>
</tr></tbody>
</table></div>
</li>
<li class="listitem">
<pre class="literallayout"><span class="identifier">ExPolicy</span> <span class="special">&amp;</span> <a name="idm140195460905840-bb"></a><span class="identifier">policy</span><span class="special">(</span><span class="special">)</span><span class="special">;</span></pre>
<p>Returns a reference to the execution policy used to construct this object.</p>
<p>Precondition: this shall be the active <code class="computeroutput"><a class="link" href="task_block.html" title="Class template task_block">task_block</a></code>. </p>
</li>
<li class="listitem">
<pre class="literallayout"><span class="identifier">ExPolicy</span> <span class="keyword">const</span> <span class="special">&amp;</span> <a name="idm140195460903472-bb"></a><span class="identifier">policy</span><span class="special">(</span><span class="special">)</span> <span class="keyword">const</span><span class="special">;</span></pre>
<p>Returns a reference to the execution policy used to construct this object.</p>
<p>Precondition: this shall be the active <code class="computeroutput"><a class="link" href="task_block.html" title="Class template task_block">task_block</a></code>. </p>
</li>
</ol></div>
</div>
</div>
</div>
<table xmlns:rev="http://www.cs.rpi.edu/~gregod/boost/tools/doc/revision" width="100%"><tr>
<td align="left"></td>
<td align="right"><div class="copyright-footer">Copyright &#169; 2011-2018 The STE||AR Group
      (http://stellar-group.org)<p>
        Distributed under the Boost Software License, Version 1.0. (See accompanying
        file <a href="http://www.boost.org/LICENSE_1_0.txt" target="_top">LICENSE_1_0.txt</a>
        or copy at <a href="http://www.boost.org/LICENSE_1_0.txt" target="_top">http://www.boost.org/LICENSE_1_0.txt</a>)
      </p>
</div></td>
</tr></table>
<hr>
<div class="spirit-nav">
<a accesskey="p" href="task_canceled_exception.html"><img src="../../../images/prev.png" alt="Prev"></a><a accesskey="u" href="../../../header/hpx/parallel/task_block_hpp.html"><img src="../../../images/up.png" alt="Up"></a><a accesskey="h" href="../../../index.html"><img src="../../../images/home.png" alt="Home"></a><a accesskey="n" href="define__idm140195460900672.html"><img src="../../../images/next.png" alt="Next"></a>
</div>
</body>
</html>
