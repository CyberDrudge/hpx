<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<title>Consuming Performance Counter Data using the HPX API</title>
<link rel="stylesheet" href="../../../../src/boostbook.css" type="text/css">
<meta name="generator" content="DocBook XSL Stylesheets V1.78.1">
<link rel="home" href="../../../../index.html" title="HPX 1.2.0">
<link rel="up" href="../consuming.html" title="Consuming Performance Counter Data">
<link rel="prev" href="commandline.html" title="Consuming Performance Counter Data from the Command Line">
<link rel="next" href="../providing.html" title="Providing Performance Counter Data">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<table cellpadding="2" width="100%"><tr><td valign="top"><img alt="HPX" width="567" height="125" src="../../../../images/hpx_1_2_0_draft.png"></td></tr></table>
<hr>
<div class="spirit-nav">
<a accesskey="p" href="commandline.html"><img src="../../../../images/prev.png" alt="Prev"></a><a accesskey="u" href="../consuming.html"><img src="../../../../images/up.png" alt="Up"></a><a accesskey="h" href="../../../../index.html"><img src="../../../../images/home.png" alt="Home"></a><a accesskey="n" href="../providing.html"><img src="../../../../images/next.png" alt="Next"></a>
</div>
<div class="section">
<div class="titlepage"><div><div><h5 class="title">
<a name="hpx.manual.performance_counters.consuming.api"></a><a class="link" href="api.html" title="Consuming Performance Counter Data using the HPX API">Consuming
          Performance Counter Data using the <span class="emphasis"><em>HPX</em></span> API</a>
</h5></div></div></div>
<p>
            <span class="emphasis"><em>HPX</em></span> provides an API allowing to discover performance
            counters and to retrieve the current value of any existing performance
            counter from any application.
          </p>
<h6>
<a name="hpx.manual.performance_counters.consuming.api.h0"></a>
            <span class="phrase"><a name="hpx.manual.performance_counters.consuming.api.discover_existing_performance_co"></a></span><a class="link" href="api.html#hpx.manual.performance_counters.consuming.api.discover_existing_performance_co">Discover
            Existing Performance Counters</a>
          </h6>
<h6>
<a name="hpx.manual.performance_counters.consuming.api.h1"></a>
            <span class="phrase"><a name="hpx.manual.performance_counters.consuming.api.retrieve_the_current_value_of_an"></a></span><a class="link" href="api.html#hpx.manual.performance_counters.consuming.api.retrieve_the_current_value_of_an">Retrieve
            the Current Value of any Performance Counter</a>
          </h6>
<p>
            Performance counters are specialized <span class="emphasis"><em>HPX</em></span> components.
            In order to retrieve a counter value, the performance counter needs to
            be instantiated. <span class="emphasis"><em>HPX</em></span> exposes a client component
            object for this purpose:
          </p>
<pre class="programlisting"><span class="identifier">hpx</span><span class="special">::</span><span class="identifier">performance_counters</span><span class="special">::</span><span class="identifier">performance_counter</span> <span class="identifier">counter</span><span class="special">(</span><span class="identifier">std</span><span class="special">::</span><span class="identifier">string</span> <span class="keyword">const</span><span class="special">&amp;</span> <span class="identifier">name</span><span class="special">);</span>
</pre>
<p>
            Instantiating an instance of this type will create the performance counter
            identified by the given <code class="computeroutput"><span class="identifier">name</span></code>.
            Only the first invocation for any given counter name will create a new
            instance of that counter, all following invocations for a given counter
            name will reference the initially created instance. This ensures, that
            at any point in time there is always not more than one active instance
            of any of the existing performance counters
          </p>
<p>
            In order to access the counter value (or invoking any of the other functionality
            related to a performance counter, like <code class="computeroutput"><span class="identifier">start</span></code>,
            <code class="computeroutput"><span class="identifier">stop</span></code>, or <code class="computeroutput"><span class="identifier">reset</span></code>) member functions of the created
            client component instance should be called:
          </p>
<pre class="programlisting"><span class="comment">// print the current number of threads created on locality 0</span>
<span class="identifier">hpx</span><span class="special">::</span><span class="identifier">performance_counters</span><span class="special">::</span><span class="identifier">performance_counter</span> <span class="identifier">count</span><span class="special">(</span>
    <span class="string">"/threads{locality#0/total}/count/cumulative"</span><span class="special">);</span>
<span class="identifier">hpx</span><span class="special">::</span><span class="identifier">cout</span> <span class="special">&lt;&lt;</span> <span class="identifier">count</span><span class="special">.</span><span class="identifier">get_value</span><span class="special">&lt;</span><span class="keyword">int</span><span class="special">&gt;().</span><span class="identifier">get</span><span class="special">()</span> <span class="special">&lt;&lt;</span> <span class="identifier">hpx</span><span class="special">::</span><span class="identifier">endl</span><span class="special">;</span>
</pre>
<p>
            For more information about the client component type see <code class="computeroutput">hpx::performance_counters::performance_counter</code>.
          </p>
<div class="note"><table border="0" summary="Note">
<tr>
<td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="../../../../images/note.png"></td>
<th align="left">Note</th>
</tr>
<tr><td align="left" valign="top">
<p>
              In the above example count.get_value() returns a future. In order to
              print the result we must append .get() to retrieve the value. You could
              write the above example like this for more clarity:
            </p>
<pre class="programlisting"><span class="comment">// print the current number of threads created on locality 0</span>
<span class="identifier">hpx</span><span class="special">::</span><span class="identifier">performance_counters</span><span class="special">::</span><span class="identifier">performance_counter</span> <span class="identifier">count</span><span class="special">(</span>
    <span class="string">"/threads{locality#0/total}/count/cumulative"</span><span class="special">);</span>
<span class="identifier">hpx</span><span class="special">::</span><span class="identifier">future</span><span class="special">&lt;</span><span class="keyword">int</span><span class="special">&gt;</span> <span class="identifier">result</span> <span class="special">=</span> <span class="identifier">count</span><span class="special">.</span><span class="identifier">get_value</span><span class="special">&lt;</span><span class="keyword">int</span><span class="special">&gt;();</span>
<span class="identifier">hpx</span><span class="special">::</span><span class="identifier">cout</span> <span class="special">&lt;&lt;</span> <span class="identifier">result</span><span class="special">.</span><span class="identifier">get</span><span class="special">()</span> <span class="special">&lt;&lt;</span> <span class="identifier">hpx</span><span class="special">::</span><span class="identifier">endl</span><span class="special">;</span>
</pre>
</td></tr>
</table></div>
</div>
<table xmlns:rev="http://www.cs.rpi.edu/~gregod/boost/tools/doc/revision" width="100%"><tr>
<td align="left"></td>
<td align="right"><div class="copyright-footer">Copyright &#169; 2011-2018 The STE||AR Group
      (http://stellar-group.org)<p>
        Distributed under the Boost Software License, Version 1.0. (See accompanying
        file <a href="http://www.boost.org/LICENSE_1_0.txt" target="_top">LICENSE_1_0.txt</a>
        or copy at <a href="http://www.boost.org/LICENSE_1_0.txt" target="_top">http://www.boost.org/LICENSE_1_0.txt</a>)
      </p>
</div></td>
</tr></table>
<hr>
<div class="spirit-nav">
<a accesskey="p" href="commandline.html"><img src="../../../../images/prev.png" alt="Prev"></a><a accesskey="u" href="../consuming.html"><img src="../../../../images/up.png" alt="Up"></a><a accesskey="h" href="../../../../index.html"><img src="../../../../images/home.png" alt="Home"></a><a accesskey="n" href="../providing.html"><img src="../../../../images/next.png" alt="Next"></a>
</div>
</body>
</html>
